#:kivy 2.3.0
#:import SwapTransition kivy.uix.screenmanager.SwapTransition

MDFloatLayout:
    #size: (700, 480)

    # ---- Build Side Navigation ----

    MDFloatLayout:
        id: nav_bar_layout
        md_bg_color: app.theme_cls.bg_darkest
        size_hint: (0.05, 1)
        pos_hint: {'center_x': 0.025, 'center_y': 0.5}

        MDIconButton:
            id: nav_button_home
            icon: 'home'
            theme_text_color: 'Custom'
            text_color: app.theme_cls.accent_dark
            md_bg_color: app.theme_cls.primary_light
            ripple_scale: 0
            pos_hint: {'center_x': 1.0, 'center_y': 0.93}
            size_hint: (1.2, 0.0875)
            on_release: app.navButtonRouter('nav_button_home')

        MDIconButton:
            id: nav_button_bemu
            icon: 'lightning-bolt'
            theme_text_color: 'Custom'
            text_color: app.theme_cls.accent_dark
            md_bg_color: app.theme_cls.primary_light
            ripple_scale: 0
            pos_hint: {'center_x': 0.7, 'center_y': 0.83}
            size_hint: (1.2, 0.0875)
            on_release: app.navButtonRouter('nav_button_bemu')

        MDIconButton:
            id: nav_button_env
            icon: 'tailwind'
            theme_text_color: 'Custom'
            text_color: app.theme_cls.accent_dark
            md_bg_color: app.theme_cls.primary_light
            ripple_scale: 0
            pos_hint: {'center_x': 0.7, 'center_y': 0.73}
            size_hint: (1.2, 0.0875)
            on_release: app.navButtonRouter('nav_button_env')

        MDIconButton:
            id: nav_button_ws
            icon: 'faucet'
            theme_text_color: 'Custom'
            text_color: app.theme_cls.accent_dark
            md_bg_color: app.theme_cls.primary_light
            ripple_scale: 0
            pos_hint: {'center_x': 0.7, 'center_y': 0.63}
            size_hint: (1.2, 0.0875)
            on_release: app.navButtonRouter('nav_button_ws')

        MDIconButton:
            id: nav_button_ls
            icon: 'lightbulb-on'
            theme_text_color: 'Custom'
            text_color: app.theme_cls.accent_dark
            md_bg_color: app.theme_cls.primary_light
            ripple_scale: 0
            pos_hint: {'center_x': 0.7, 'center_y': 0.53}
            size_hint: (1.2, 0.0875)
            on_release: app.navButtonRouter('nav_button_ls')

        MDIconButton:
            id: nav_button_theme
            icon: 'theme-light-dark'
            theme_text_color: 'Custom'
            text_color: app.theme_cls.accent_dark
            md_bg_color: app.theme_cls.primary_light
            ripple_scale: 0
            pos_hint: {'center_x': 0.7, 'center_y': 0.27}
            size_hint: (1.2, 0.0875)
            on_release: app.switchTheme()

        MDIconButton:
            id: nav_button_settings
            icon: 'tune-vertical'
            theme_text_color: 'Custom'
            text_color: app.theme_cls.accent_dark
            md_bg_color: app.theme_cls.primary_light
            ripple_scale: 0
            pos_hint: {'center_x': 0.7, 'center_y': 0.17}
            size_hint: (1.2, 0.0875)
            on_release: app.navButtonRouter('nav_button_settings')

        MDIconButton:
            id: nav_button_power
            icon: 'power'
            theme_text_color: 'Custom'
            text_color: app.theme_cls.accent_dark
            md_bg_color: app.theme_cls.primary_light
            ripple_scale: 0
            pos_hint: {'center_x': 0.7, 'center_y': 0.07}
            size_hint: (1.2, 0.0875)
            on_release: app.power_dialog(self)

    # ---- Build Main Layout Page Manager ----

    PageManager:
        id: page_manager
        transition: SwapTransition(duration = 0.25)

        # ---- App Home Screen ----

        AppHomeScreen:
            name: 'app_home_page'

            MDFloatLayout:
                id: app_home_page_layout
                size_hint: (0.95, 1)
                pos_hint: {'center_x': 0.525, 'center_y': 0.5}

                # ---- Build Weather Card ----

                MDCard:
                    id: weather_quick_card
                    md_bg_color: app.theme_cls.bg_darkest
                    size_hint: (0.4, 0.9)
                    pos_hint: {'center_x': 0.275, 'center_y': 0.5}

                    MDFloatLayout:
                        MDLabel:
                            text: 'Outside Temp'
                            font_size: 14
                            theme_text_color: 'Hint'
                            pos_hint: {'center_x': 0.62, 'center_y': 0.78}

                        MDLabel:
                            id: outside_temp_quick_label
                            text: u'--\N{DEGREE SIGN}'
                            font_style: 'H2'
                            theme_text_color: 'Primary'
                            pos_hint: {'center_x': 0.64, 'center_y': 0.87}

                        # MDIcon:
                        #     id: weather_icon
                        #     icon: 'cloud-question-outline'
                        #     theme_text_color: 'Hint'
                        #     font_size: 128
                        #     pos_hint: {'center_x': 0.72, 'center_y': 0.87}

                        MDFloatLayout:
                            size_hint: (0.3, 0.3)
                            pos_hint: {'center_x': 0.7, 'center_y': 0.85}
                            AsyncImage:
                                id: weather_icon
                                source: 'images/weather-unknown-1.png'
                                fit_mode: 'fill'
                                allow_stretch: 'false'
                                pos_hint: {'center_x': 0.5, 'center_y': 0.5}

                        MDLabel:
                            text: 'Today'
                            font_size: 14
                            theme_text_color: 'Hint'
                            pos_hint: {'center_x': 0.64, 'center_y': .68}
                        
                        MDLabel:
                            id: location_label
                            text: ''
                            font_size: 14
                            theme_text_color: 'Hint'
                            pos_hint: {'center_x': 0.60, 'center_y': 0.64}
                        
                        MDLabel:
                            text: 'High'
                            font_size: 12
                            theme_text_color: 'Hint'
                            pos_hint: {'center_x': 0.97, 'center_y': .62}

                        MDLabel:
                            id: high_temp_quick_label
                            text: u'--\N{DEGREE SIGN}'
                            font_style: 'H4'
                            theme_text_color: 'Primary'
                            pos_hint: {'center_x': 0.95, 'center_y': 0.68}
                        
                        MDLabel:
                            text: 'Low'
                            font_size: 12
                            theme_text_color: 'Hint'
                            pos_hint: {'center_x': 1.23, 'center_y': .62}

                        MDLabel:
                            id: low_temp_quick_label
                            text: u'--\N{DEGREE SIGN}'
                            font_style: 'H5'
                            theme_text_color: 'Primary'
                            pos_hint: {'center_x': 1.22, 'center_y': 0.68}

                        MDWidget:
                            id: weather_card_separator

                            canvas:
                                Color:
                                    rgba: app.theme_cls.accent_light
                                Line:
                                    points: (0.15*kivy.core.window.Window.width, 0.56*kivy.core.window.Window.height, 0.475*kivy.core.window.Window.width, 0.56*kivy.core.window.Window.height)
                                    width: 2

                        MDLabel:
                            text: 'Inside Temp'
                            font_size: 12
                            theme_text_color: 'Hint'
                            pos_hint: {'center_x': 0.63, 'center_y': .23}

                        MDLabel:
                            id: inside_temp_quick_label
                            text: u'--\N{DEGREE SIGN}'
                            font_style: 'H1'
                            theme_text_color: 'Primary'
                            pos_hint: {'center_x': 0.6, 'center_y': 0.37}

                        MDIconButton:
                            icon: 'plus-circle'
                            theme_text_color: 'Custom'
                            ripple_color: app.theme_cls.primary_light
                            ripple_alpha: 0.3
                            ripple_duration_in_fast: 0.1
                            text_color: app.theme_cls.accent_dark
                            pos_hint: {'center_x': 0.85, 'center_y': 0.5}

                        MDLabel:
                            id: set_temp_quick_label
                            text: u'69\N{DEGREE SIGN}'
                            font_style: 'H4'
                            theme_text_color: 'Secondary'
                            pos_hint: {'center_x': 1.27, 'center_y': 0.38}

                        MDIconButton:
                            icon: 'minus-circle'
                            theme_text_color: 'Custom'
                            ripple_color: app.theme_cls.primary_light
                            ripple_alpha: 0.3
                            ripple_duration_in_fast: 0.1
                            text_color: app.theme_cls.accent_dark
                            pos_hint: {'center_x': 0.85, 'center_y': 0.25}

                        EnvFanToggleButton:
                            id: env_fan_quick_switch
                            icon: 'fan'
                            md_bg_color: app.theme_cls.accent_light
                            ripple_scale: 0
                            theme_text_color: 'Custom'
                            text_color: app.theme_cls.accent_dark
                            pos_hint: {'center_x': 0.2, 'center_y': 0.09}
                            on_release: self.state = 'down' if self.state == 'normal' else 'normal'

                        EnvCoolToggleButton:
                            id: env_cool_quick_switch
                            icon: 'snowflake'
                            md_bg_color: app.theme_cls.accent_light
                            ripple_scale: 0
                            theme_text_color: 'Custom'
                            text_color: app.theme_cls.accent_dark
                            pos_hint: {'center_x': 0.5, 'center_y': 0.09}
                            on_release: self.state = 'down' if self.state == 'normal' else 'normal'

                        EnvHeatToggleButton:
                            id: env_heat_quick_switch
                            icon: 'fire'
                            md_bg_color: app.theme_cls.accent_light
                            ripple_scale: 0
                            theme_text_color: 'Custom'
                            text_color: app.theme_cls.accent_dark
                            pos_hint: {'center_x': 0.8, 'center_y': 0.09}
                            on_release: self.state = 'down' if self.state == 'normal' else 'normal'

                # ---- Build Time & Date Card ----

                MDCard:
                    id: time_quick_card
                    md_bg_color: app.theme_cls.bg_darkest
                    size_hint: (0.4, 0.2)
                    pos_hint: {'center_x': 0.725, 'center_y': 0.85}

                    MDFloatLayout:
                        MDLabel:
                            id: home_time_label
                            text: '--:--'
                            pos_hint: {'x': 0.1, 'center_y': 0.7}
                            font_style: 'H5'
                        
                        MDLabel:
                            id: home_date_label
                            text: ''
                            pos_hint: {'x': 0.1, 'center_y': 0.35}
                            font_style: 'Caption'

                        WifiToggleButton:
                            id: wifi_quick_switch
                            icon: 'wifi-strength-off-outline'
                            md_bg_color: app.theme_cls.accent_light
                            ripple_scale: 0
                            theme_text_color: 'Custom'
                            text_color: app.theme_cls.accent_dark
                            pos_hint: {'center_x': .62, 'center_y': 0.5}
                            on_release: self.state = 'down' if self.state == 'normal' else 'normal'
                        
                        BLEToggleButton:
                            id: ble_quick_switch
                            icon: 'bluetooth-off'
                            md_bg_color: app.theme_cls.accent_light
                            ripple_scale: 0
                            theme_text_color: 'Custom'
                            text_color: app.theme_cls.accent_dark
                            pos_hint: {'center_x': .85, 'center_y': 0.5}
                            on_release: self.state = 'down' if self.state == 'normal' else 'normal'

                # ---- Build BEMU Card ----

                MDCard:
                    id: bemu_quick_card
                    md_bg_color: app.theme_cls.bg_darkest
                    size_hint: (0.4, 0.2)
                    pos_hint: {'center_x': 0.725, 'center_y': 0.6}
                    on_release: app.navButtonRouter('nav_button_bemu')

                # ---- Build WS Card ----

                MDCard:
                    id: ws_quick_card
                    md_bg_color: app.theme_cls.bg_darkest
                    size_hint: (0.4, 0.2)
                    pos_hint: {'center_x': 0.725, 'center_y': 0.35}
                    #on_release: app.navButtonRouter('nav_button_ws')

                    MDFloatLayout:

                        MDIcon:
                            id: fresh_water_quick_icon_75
                            icon: 'square-off-outline'
                            theme_text_color: 'Custom'
                            text_color: app.theme_cls.primary_light
                            pos_hint: {'center_x': 0.2,'center_y': 0.8}
                        
                        MDIcon:
                            id: fresh_water_quick_icon_50
                            icon: 'square-off-outline'
                            theme_text_color: 'Custom'
                            text_color: app.theme_cls.primary_light
                            pos_hint: {'center_x': 0.2,'center_y': 0.6}
                        
                        MDIcon:
                            id: fresh_water_quick_icon_25
                            icon: 'square-off-outline'
                            theme_text_color: 'Custom'
                            text_color: app.theme_cls.primary_light
                            pos_hint: {'center_x': 0.2,'center_y': 0.4}
                        
                        MDIcon:
                            id: fresh_water_quick_icon_0
                            icon: 'square-off-outline'
                            theme_text_color: 'Custom'
                            text_color: app.theme_cls.primary_light
                            pos_hint: {'center_x': 0.2,'center_y': 0.2}

                        MDIcon:
                            id: quick_fresh_to_pump_line
                            icon: 'minus'
                            theme_text_color: 'Custom'
                            text_color: app.theme_cls.accent_dark
                            pos_hint: {'center_x': 0.3,'center_y': 0.5}

                        WSPumpToggleButton:
                            id: ws_pump_quick_switch
                            text: 'Pump'
                            md_bg_color: app.theme_cls.accent_light
                            ripple_scale: 0
                            theme_text_color: 'Custom'
                            text_color: app.theme_cls.accent_dark
                            pos_hint: {'center_x': 0.5, 'center_y': 0.72}
                            on_release: self.state = 'down' if self.state == 'normal' else 'normal'
                        
                        WSHeaterToggleButton:
                            id: ws_heater_quick_switch
                            text: 'Heater'
                            md_bg_color: app.theme_cls.accent_light
                            ripple_scale: 0
                            theme_text_color: 'Custom'
                            text_color: app.theme_cls.accent_dark
                            pos_hint: {'center_x': 0.5, 'center_y': 0.28}
                            on_release: self.state = 'down' if self.state == 'normal' else 'normal'

                        MDIcon:
                            id: quick_pump_to_grey_line
                            icon: 'minus'
                            theme_text_color: 'Custom'
                            text_color: app.theme_cls.accent_dark
                            pos_hint: {'center_x': 0.7,'center_y': 0.5}

                        MDIcon:
                            id: grey_water_quick_icon_75
                            icon: 'square-off-outline'
                            theme_text_color: 'Custom'
                            text_color: app.theme_cls.accent_light
                            pos_hint: {'center_x': 0.8,'center_y': 0.8}
                        
                        MDIcon:
                            id: grey_water_quick_icon_50
                            icon: 'square-off-outline'
                            theme_text_color: 'Custom'
                            text_color: app.theme_cls.accent_light
                            pos_hint: {'center_x': 0.8,'center_y': 0.6}
                        
                        MDIcon:
                            id: grey_water_quick_icon_25
                            icon: 'square-off-outline'
                            theme_text_color: 'Custom'
                            text_color: app.theme_cls.accent_light
                            pos_hint: {'center_x': 0.8,'center_y': 0.4}
                        
                        MDIcon:
                            id: grey_water_quick_icon_0
                            icon: 'square-off-outline'
                            theme_text_color: 'Custom'
                            text_color: app.theme_cls.accent_light
                            pos_hint: {'center_x': 0.8,'center_y': 0.2}

                # ---- Build LS Card ----

                MDCard:
                    id: ls_quick_card
                    md_bg_color: app.theme_cls.bg_darkest
                    size_hint: (0.4, 0.15)
                    pos_hint: {'center_x': 0.725, 'center_y': 0.125}
                    #on_release: app.navButtonRouter('nav_button_ls')

                    MDFloatLayout:

                        DiningLightToggleButton:
                            id: ls_1_quick_switch
                            icon: 'table-furniture'
                            md_bg_color: app.theme_cls.accent_light
                            ripple_scale: 0
                            theme_text_color: 'Custom'
                            text_color: app.theme_cls.accent_dark
                            pos_hint: {'center_x': 0.15, 'center_y': 0.5}
                            on_release: self.state = 'down' if self.state == 'normal' else 'normal'

                        BedroomLightToggleButton:
                            id: ls_2_quick_switch
                            icon: 'bed'
                            md_bg_color: app.theme_cls.accent_light
                            ripple_scale: 0
                            theme_text_color: 'Custom'
                            text_color: app.theme_cls.accent_dark
                            pos_hint: {'center_x': 0.38, 'center_y': 0.5}
                            on_release: self.state = 'down' if self.state == 'normal' else 'normal'

                        KitchenLightToggleButton:
                            id: ls_3_quick_switch
                            icon: 'countertop'
                            md_bg_color: app.theme_cls.accent_light
                            ripple_scale: 0
                            theme_text_color: 'Custom'
                            text_color: app.theme_cls.accent_dark
                            pos_hint: {'center_x': 0.62, 'center_y': 0.5}
                            on_release: self.state = 'down' if self.state == 'normal' else 'normal'

                        BathroomLightToggleButton:
                            id: ls_4_quick_switch
                            icon: 'shower-head'
                            md_bg_color: app.theme_cls.accent_light
                            ripple_scale: 0
                            theme_text_color: 'Custom'
                            text_color: app.theme_cls.accent_dark
                            pos_hint: {'center_x': 0.85, 'center_y': 0.5}
                            on_release: self.state = 'down' if self.state == 'normal' else 'normal'


        BEMUHomeScreen:
            name: 'bemu_home_page'

            MDFloatLayout:
                id: bemu_home_page_layout
                size_hint: (0.95, 1)
                pos_hint: {'center_x': 0.525, 'center_y': 0.5}

                # ---- Build Main Card ----

                MDCard:
                    id: bemu_home_card
                    md_bg_color: app.theme_cls.bg_darkest
                    size_hint: (0.85, 0.9)
                    pos_hint: {'center_x': 0.5, 'center_y': 0.5}

        EnvHomeScreen:
            name: 'env_home_page'

            MDFloatLayout:
                id: env_home_page_layout
                size_hint: (0.95, 1)
                pos_hint: {'center_x': 0.525, 'center_y': 0.5}

                # ---- Build Main Card ----

                MDCard:
                    id: env_home_card
                    md_bg_color: app.theme_cls.bg_darkest
                    size_hint: (0.85, 0.9)
                    pos_hint: {'center_x': 0.5, 'center_y': 0.5}

        WSHomeScreen:
            name: 'ws_home_page'

            MDFloatLayout:
                id: ws_home_page_layout
                size_hint: (0.95, 1)
                pos_hint: {'center_x': 0.525, 'center_y': 0.5}

                # ---- Build Main Card ----

                MDCard:
                    id: ws_home_card
                    md_bg_color: app.theme_cls.bg_darkest
                    size_hint: (0.85, 0.9)
                    pos_hint: {'center_x': 0.5, 'center_y': 0.5}

                    MDFloatLayout:

                        MDIcon:
                            id: fresh_water_icon_75
                            icon: 'square-off-outline'
                            theme_text_color: 'Custom'
                            text_color: app.theme_cls.primary_light
                            pos_hint: {'center_x': 0.1,'center_y': 0.82}
                            size_hint: (None, None)
                            font_size: 64
                        
                        MDIcon:
                            id: fresh_water_icon_50
                            icon: 'square-off-outline'
                            theme_text_color: 'Custom'
                            text_color: app.theme_cls.primary_light
                            pos_hint: {'center_x': 0.1,'center_y': 0.62}
                            font_size: 64
                        
                        MDIcon:
                            id: fresh_water_icon_25
                            icon: 'square-off-outline'
                            theme_text_color: 'Custom'
                            text_color: app.theme_cls.primary_light
                            pos_hint: {'center_x': 0.1,'center_y': 0.42}
                            font_size: 64
                        
                        MDIcon:
                            id: fresh_water_icon_0
                            icon: 'square-off-outline'
                            theme_text_color: 'Custom'
                            text_color: app.theme_cls.primary_light
                            pos_hint: {'center_x': 0.1,'center_y': 0.22}
                            font_size: 64

                        MDLabel:
                            id: fresh_water_label
                            text: 'Fresh'
                            halign: 'right'
                            theme_text_color: 'Custom'
                            text_color: app.theme_cls.accent_dark
                            font_size: 24
                            bold: True
                            pos_hint: {'center_x': -0.375,'center_y': 0.07}

                        MDIcon:
                            id: fresh_to_pump_line
                            icon: 'minus'
                            theme_text_color: 'Custom'
                            text_color: app.theme_cls.accent_dark
                            pos_hint: {'center_x': 0.2,'center_y': 0.5}
                            font_size: 72

                        WSPumpToggleButton:
                            id: ws_pump_switch
                            text: 'Pump'
                            md_bg_color: app.theme_cls.accent_light
                            ripple_scale: 0
                            theme_text_color: 'Custom'
                            text_color: app.theme_cls.accent_dark
                            pos_hint: {'center_x': 0.3, 'center_y': 0.6}
                            on_release: self.state = 'down' if self.state == 'normal' else 'normal'
                        
                        WSHeaterToggleButton:
                            id: ws_heater_switch
                            text: 'Heater'
                            md_bg_color: app.theme_cls.accent_light
                            ripple_scale: 0
                            theme_text_color: 'Custom'
                            text_color: app.theme_cls.accent_dark
                            pos_hint: {'center_x': 0.3, 'center_y': 0.4}
                            on_release: self.state = 'down' if self.state == 'normal' else 'normal'

                        MDIcon:
                            id: pump_to_grey_line
                            icon: 'minus'
                            theme_text_color: 'Custom'
                            text_color: app.theme_cls.accent_dark
                            pos_hint: {'center_x': 0.4,'center_y': 0.5}
                            font_size: 72

                        MDIcon:
                            id: grey_water_icon_75
                            icon: 'square-off-outline'
                            theme_text_color: 'Custom'
                            text_color: app.theme_cls.accent_light
                            pos_hint: {'center_x': 0.5,'center_y': 0.82}
                            font_size: 64
                        
                        MDIcon:
                            id: grey_water_icon_50
                            icon: 'square-off-outline'
                            theme_text_color: 'Custom'
                            text_color: app.theme_cls.accent_light
                            pos_hint: {'center_x': 0.5,'center_y': 0.62}
                            font_size: 64
                        
                        MDIcon:
                            id: grey_water_icon_25
                            icon: 'square-off-outline'
                            theme_text_color: 'Custom'
                            text_color: app.theme_cls.accent_light
                            pos_hint: {'center_x': 0.5,'center_y': 0.42}
                            font_size: 64
                        
                        MDIcon:
                            id: grey_water_icon_0
                            icon: 'square-off-outline'
                            theme_text_color: 'Custom'
                            text_color: app.theme_cls.accent_light
                            pos_hint: {'center_x': 0.5,'center_y': 0.22}
                            font_size: 64

                        MDLabel:
                            id: grey_water_label
                            text: 'Grey'
                            theme_text_color: 'Custom'
                            text_color: app.theme_cls.accent_dark
                            font_size: 24
                            bold: True
                            pos_hint: {'center_x': 0.96,'center_y': 0.07}

                        ShowerFanToggleButton:
                            id: shower_fan_switch
                            text: '  Shower Fan  '
                            md_bg_color: app.theme_cls.accent_light
                            ripple_scale: 0
                            theme_text_color: 'Custom'
                            text_color: app.theme_cls.accent_dark
                            pos_hint: {'center_x': 0.8, 'center_y': 0.75}
                            on_release: self.state = 'down' if self.state == 'normal' else 'normal'

                        TankHeaterToggleButton:
                            id: tank_heater_switch
                            text: 'Grey Tank Heat'
                            md_bg_color: app.theme_cls.accent_light
                            ripple_scale: 0
                            theme_text_color: 'Custom'
                            text_color: app.theme_cls.accent_dark
                            pos_hint: {'center_x': 0.8, 'center_y': 0.5}
                            on_release: self.state = 'down' if self.state == 'normal' else 'normal'

                        TankValveToggleButton:
                            id: tank_valve_switch
                            text: 'Grey Tank Dump'
                            md_bg_color: app.theme_cls.accent_light
                            ripple_scale: 0
                            theme_text_color: 'Custom'
                            text_color: app.theme_cls.accent_dark
                            pos_hint: {'center_x': 0.8, 'center_y': 0.25}
                            on_release: self.state = 'down' if self.state == 'normal' else 'normal'

        LSHomeScreen:
            name: 'ls_home_page'

            MDFloatLayout:
                id: ls_home_page_layout
                size_hint: (0.95, 1)
                pos_hint: {'center_x': 0.525, 'center_y': 0.5}

                # ---- Build Main Card ----

                MDCard:
                    id: ls_home_card
                    md_bg_color: app.theme_cls.bg_darkest
                    size_hint: (0.85, 0.9)
                    pos_hint: {'center_x': 0.5, 'center_y': 0.5}

                    MDBoxLayout:
                        orientation: 'vertical'

                        MDFloatLayout:
                            orientation: 'horizontal'
                            size_hint: (1, 0.2)

                            DiningLightToggleButton:
                                id: ls_1_switch
                                icon: 'table-furniture'
                                md_bg_color: app.theme_cls.accent_light
                                ripple_scale: 0
                                theme_text_color: 'Custom'
                                text_color: app.theme_cls.accent_dark
                                pos_hint: {'center_x': 0.125, 'center_y': 0.5}
                                on_release: self.state = 'down' if self.state == 'normal' else 'normal'

                            BedroomLightToggleButton:
                                id: ls_2_switch
                                icon: 'bed'
                                md_bg_color: app.theme_cls.accent_light
                                ripple_scale: 0
                                theme_text_color: 'Custom'
                                text_color: app.theme_cls.accent_dark
                                pos_hint: {'center_x': 0.375, 'center_y': 0.5}
                                on_release: self.state = 'down' if self.state == 'normal' else 'normal'

                            KitchenLightToggleButton:
                                id: ls_3_switch
                                icon: 'countertop'
                                md_bg_color: app.theme_cls.accent_light
                                ripple_scale: 0
                                theme_text_color: 'Custom'
                                text_color: app.theme_cls.accent_dark
                                pos_hint: {'center_x': 0.625, 'center_y': 0.5}
                                on_release: self.state = 'down' if self.state == 'normal' else 'normal'

                            BathroomLightToggleButton:
                                id: ls_4_switch
                                icon: 'shower-head'
                                md_bg_color: app.theme_cls.accent_light
                                ripple_scale: 0
                                theme_text_color: 'Custom'
                                text_color: app.theme_cls.accent_dark
                                pos_hint: {'center_x': 0.875, 'center_y': 0.5}
                                on_release: self.state = 'down' if self.state == 'normal' else 'normal'

                        MDBoxLayout:
                            orientation: 'horizontal'
                            size_hint: (1, 0.8)

                            MDSlider:
                                id: ls_1_slider
                                orientation: 'vertical'
                                min: 10
                                max: 255
                                step: 1
                                value: 191
                                hint: False
                                show_off: False
                                on_value: app.lightingAdjust(*args, 'ls_1_slider')

                            MDSlider:
                                id: ls_2_slider
                                orientation: 'vertical'
                                min: 10
                                max: 255
                                step: 1
                                value: 191
                                hint: False
                                show_off: False
                                on_value: app.lightingAdjust(*args, 'ls_2_slider')

                            MDSlider:
                                id: ls_3_slider
                                orientation: 'vertical'
                                min: 10
                                max: 255
                                step: 1
                                value: 191
                                hint: False
                                show_off: False
                                on_value: app.lightingAdjust(*args, 'ls_3_slider')

                            MDSlider:
                                id: ls_4_slider
                                orientation: 'vertical'
                                min: 10
                                max: 255
                                step: 1
                                value: 191
                                hint: False
                                show_off: False
                                on_value: app.lightingAdjust(*args, 'ls_4_slider')
        
        SettingsHomeScreen:
            name: 'settings_home_page'

            MDFloatLayout:
                id: settings_home_page_layout
                size_hint: (0.95, 1)
                pos_hint: {'center_x': 0.525, 'center_y': 0.5}

                # ---- Build Main Card ----

                MDCard:
                    id: settings_home_card
                    md_bg_color: app.theme_cls.bg_darkest
                    size_hint: (0.85, 0.9)
                    pos_hint: {'center_x': 0.5, 'center_y': 0.5}
                    padding: (100, 50)

                    MDFloatLayout:
                        id: settings_button_layout
                        size_hint: (1, 1)
                        pos_hint: {'center_x': 0.5, 'center_y': 0.5}

                        MDFillRoundFlatIconButton:
                            id: user_settings_button
                            text: '    User Settings   '
                            icon: 'dip-switch'
                            size_hint: (0.8, 0.2)
                            pos_hint: {'center_x': 0.5, 'y': 0.75}
                            theme_text_color: 'Custom'
                            text_color: app.theme_cls.accent_dark if self.theme_cls.theme_style == 'Light' else self.theme_cls.accent_light
                            icon_color: app.theme_cls.accent_dark if self.theme_cls.theme_style == 'Light' else self.theme_cls.accent_light
                            md_bg_color: self.theme_cls.primary_light if self.theme_cls.theme_style == 'Light' else self.theme_cls.primary_dark
                            font_size: 48
                            on_release:
                                app.selectSettingsScreen('user_settings_button')
                        
                        MDFillRoundFlatIconButton:
                            id: device_button
                            text: '         Devices        '
                            icon: 'transit-connection-horizontal'
                            size_hint: (0.8, 0.2)
                            pos_hint: {'center_x': 0.5, 'y': 0.45}
                            theme_text_color: 'Custom'
                            text_color: app.theme_cls.accent_dark if self.theme_cls.theme_style == 'Light' else self.theme_cls.accent_light
                            icon_color: app.theme_cls.accent_dark if self.theme_cls.theme_style == 'Light' else self.theme_cls.accent_light
                            md_bg_color: self.theme_cls.primary_light if self.theme_cls.theme_style == 'Light' else self.theme_cls.primary_dark
                            font_size: 48
                            on_release:
                                app.selectSettingsScreen('device_button')
                        
                        MDFillRoundFlatIconButton:
                            id: debug_button
                            text: '          Debug         '
                            icon: 'bug'
                            size_hint: (0.8, 0.2)
                            pos_hint: {'center_x': 0.5, 'y': 0.15}
                            theme_text_color: 'Custom'
                            text_color: app.theme_cls.accent_dark if self.theme_cls.theme_style == 'Light' else self.theme_cls.accent_light
                            icon_color: app.theme_cls.accent_dark if self.theme_cls.theme_style == 'Light' else self.theme_cls.accent_light
                            md_bg_color: self.theme_cls.primary_light if self.theme_cls.theme_style == 'Light' else self.theme_cls.primary_dark
                            font_size: 48
                            on_release:
                                app.selectSettingsScreen('debug_button')

        UserSettingsScreen:
            name: 'settings_user_settings_page'

            MDFloatLayout:
                id: settings_user_settings_page_layout
                size_hint: (0.95, 1)
                pos_hint: {'center_x': 0.525, 'center_y': 0.5}

                MDCard:
                    id: settings_user_settings_card
                    md_bg_color: app.theme_cls.bg_darkest
                    size_hint: (0.85, 0.9)
                    pos_hint: {'center_x': 0.5, 'center_y': 0.5}
                    padding: (100, 50)

                    MDBoxLayout:
                        id: settings_user_settings_page_layout
                        orientation: 'vertical'
                        size_hint: (1, 1)

                        MDFloatLayout:
                            id: settings_user_settings_title_bar
                            size_hint: (1, 0.1)

                            MDIconButton:
                                id: settings_user_settings_button_back
                                icon: 'chevron-left'
                                theme_text_color: 'Custom'
                                text_color: app.theme_cls.accent_dark if self.theme_cls.theme_style == 'Light' else self.theme_cls.accent_light
                                md_bg_color: self.theme_cls.primary_light if self.theme_cls.theme_style == 'Light' else self.theme_cls.primary_dark
                                pos_hint: {'center_x': -0.1, 'center_y': 0.5}
                                size_hint: (0.1, 1.4)
                                on_release: app.navButtonRouter('nav_button_settings')

                            MDIconButton:
                                id: settings_user_settings_title_icon
                                icon: 'dip-switch'
                                theme_text_color: 'Custom'
                                text_color: app.theme_cls.accent_dark
                                md_bg_color: app.theme_cls.bg_darkest if app.theme_cls.theme_style == 'Light' else app.theme_cls.bg_light
                                pos_hint: {'x': 0.15, 'center_y': 0.5}
                                size_hint: (0.05, 0.7)

                            MDLabel:
                                id: settings_user_settings_title
                                text: 'User Settings'
                                theme_text_color: 'Custom'
                                text_color: app.theme_cls.accent_dark
                                font_size: 48
                                pos_hint: {'x': 0.25, 'center_y': 0.5}

                        MDFloatLayout:
                            id: settings_user_settings_top_fill
                            size_hint: (1, 0.1)
                        
                        MDFloatLayout:
                            id: settings_user_settings_temp_select
                            size_hint: (1, 0.2)

                            MDLabel:
                                id: settings_user_settings_temp_select_label
                                text: 'Temperature Scale:'
                                theme_text_color: 'Custom'
                                text_color: app.theme_cls.accent_dark
                                pos_hint: {'x': 0, 'center_y': 0.5}

                            SettingsToggleButton:
                                id: celsius_toggle
                                text: 'Celsius'
                                theme_text_color: 'Custom'
                                md_bg_color: app.theme_cls.accent_light
                                text_color: app.theme_cls.accent_dark
                                ripple_scale: 0
                                pos_hint: {'center_x': 0.5, 'center_y': 0.5}
                                on_release: self.state = 'down' if self.state == 'normal' else 'normal'

                            SettingsToggleButton:
                                id: fahrenheit_toggle
                                text: 'Fahrenheit'
                                theme_text_color: 'Custom'
                                md_bg_color: app.theme_cls.accent_light
                                text_color: app.theme_cls.accent_dark
                                ripple_scale: 0
                                pos_hint: {'center_x': 0.8, 'center_y': 0.5}
                                on_release: self.state = 'down' if self.state == 'normal' else 'normal'
                        
                        MDFloatLayout:
                            id: settings_user_settings_time_select
                            size_hint: (1, 0.2)

                            MDLabel:
                                id: settings_user_settings_time_select_label
                                text: 'Time Format:'
                                theme_text_color: 'Custom'
                                text_color: app.theme_cls.accent_dark
                                pos_hint: {'x': 0, 'center_y': 0.5}

                            SettingsToggleButton:
                                id: hour12_toggle
                                text: '12 hour'
                                theme_text_color: 'Custom'
                                md_bg_color: app.theme_cls.accent_light
                                text_color: app.theme_cls.accent_dark
                                ripple_scale: 0
                                pos_hint: {'center_x': 0.5, 'center_y': 0.5}
                                on_release: self.state = 'down' if self.state == 'normal' else 'normal'

                            SettingsToggleButton:
                                id: hour24_toggle
                                text: '24 hour'
                                theme_text_color: 'Custom'
                                md_bg_color: app.theme_cls.accent_light
                                text_color: app.theme_cls.accent_dark
                                ripple_scale: 0
                                pos_hint: {'center_x': 0.8, 'center_y': 0.5}
                                on_release: self.state = 'down' if self.state == 'normal' else 'normal'
                        
                        MDFloatLayout:
                            id: settings_user_settings_brightness_select
                            size_hint: (1, 0.2)

                            MDLabel:
                                id: settings_user_settings_brightness_select_label
                                text: 'Screen Brightness:'
                                theme_text_color: 'Custom'
                                text_color: app.theme_cls.accent_dark
                                pos_hint: {'x': 0, 'center_y': 0.5}

                            MDSlider:
                                id: brightness_slider
                                orientation: 'horizontal'
                                min: 8
                                max: 191
                                step: 1
                                value: 128
                                hint: False
                                show_off: False
                                size_hint: (0.65, 1)
                                pos_hint: {'center_x': 0.66, 'center_y': 0.5}
                                on_value: app.brightnessAdjust(*args)
                        
                        MDFloatLayout:
                            id: settings_user_settings_fill_bottom
                            size_hint: (1, 0.2)

        DeviceScreen:
            name: 'settings_device_page'

            MDFloatLayout:
                id: settings_device_page_layout
                size_hint: (0.95, 1)
                pos_hint: {'center_x': 0.525, 'center_y': 0.5}

                MDCard:
                    id: settings_device_card
                    md_bg_color: app.theme_cls.bg_darkest
                    size_hint: (0.85, 0.9)
                    pos_hint: {'center_x': 0.5, 'center_y': 0.5}
                    padding: (100, 50)


                    MDScrollView:
                        id: device_scroll
                        size: (kivy.core.window.Window.width, 0.8*kivy.core.window.Window.height)
                        do_scroll_y: True
                        scroll_y: 1

                        MDBoxLayout:
                            id: settings_device_card_layout
                            orientation: 'vertical'
                            size_hint_y: None
                            height: self.minimum_height
                            padding: dp(10)

        DebugScreen:
            name: 'settings_debug_page'

            MDFloatLayout:
                id: settings_debug_page_layout
                size_hint: (0.95, 1)
                pos_hint: {'center_x': 0.525, 'center_y': 0.5}

                MDCard:
                    id: settings_debug_card
                    md_bg_color: app.theme_cls.bg_darkest
                    size_hint: (0.85, 0.9)
                    pos_hint: {'center_x': 0.5, 'center_y': 0.5}
                    padding: (100, 50)

                    MDScrollView:
                        id: debug_terminal
                        size: (kivy.core.window.Window.width, 0.8*kivy.core.window.Window.height)
                        do_scroll_y: True
                        scroll_y: 1

                        MDBoxLayout:
                            id: debug_layout
                            orientation: 'vertical'
                            size_hint_y: None
                            height: self.minimum_height
                            padding: dp(10)

<Keyboard>
    orientation: 'vertical'
    size_hint: (None, None)
    size: (0.9*kivy.core.window.Window.width, 0.9*kivy.core.window.Window.height)
    padding: (0.05*kivy.core.window.Window.width, 0.05*kivy.core.window.Window.height)
    spacing: 30

    MDBoxLayout:
        orientation: 'horizontal'
        size_hint: (1, 0.2)

        MDFloatLayout:
            size_hint: (1, 1)

            PasswordTextEntry:
                id: keyboard_text_field
                text: root.text
                size_hint: (0.8, 0.8)
                pos_hint: {'center_x': .5, 'center_y': 1}

    MDBoxLayout:
        orientation: 'horizontal'
        spacing: 10
        size_hint: (1, 0.2)

        KeyboardButton:
            id: one_key
            text: '1'
            size_hint: (0.1, 1)
            on_release:
                root.text += self.text
                root.text_object.text += self.text

        KeyboardButton:
            id: two_key
            text: '2'
            size_hint: (0.1, 1)
            on_release:
                root.text += self.text
                root.text_object.text += self.text

        KeyboardButton:
            id: three_key
            text: '3'
            size_hint: (0.1, 1)
            on_release:
                root.text += self.text
                root.text_object.text += self.text

        KeyboardButton:
            id: four_key
            text: '4'
            size_hint: (0.1, 1)
            on_release:
                root.text += self.text
                root.text_object.text += self.text

        KeyboardButton:
            id: five_key
            text: '5'
            size_hint: (0.1, 1)
            on_release:
                root.text += self.text
                root.text_object.text += self.text

        KeyboardButton:
            id: six_key
            text: '6'
            size_hint: (0.1, 1)
            on_release:
                root.text += self.text
                root.text_object.text += self.text

        KeyboardButton:
            id: seven_key
            text: '7'
            size_hint: (0.1, 1)
            on_release:
                root.text += self.text
                root.text_object.text += self.text

        KeyboardButton:
            id: eight_key
            text: '8'
            size_hint: (0.1, 1)
            on_release:
                root.text += self.text
                root.text_object.text += self.text

        KeyboardButton:
            id: nine_key
            text: '9'
            size_hint: (0.1, 1)
            on_release:
                root.text += self.text
                root.text_object.text += self.text

        KeyboardButton:
            id: zero_key
            text: '0'
            size_hint: (0.1, 1)
            on_release:
                root.text += self.text
                root.text_object.text += self.text

    MDBoxLayout:
        orientation: 'horizontal'
        spacing: 10
        size_hint: (1, 0.2)

        KeyboardButton:
            id: q_key
            text: 'q'
            size_hint: (0.1, 1)
            on_release:
                root.text += self.text
                root.text_object.text += self.text

        KeyboardButton:
            id: w_key
            text: 'w'
            size_hint: (0.1, 1)
            on_release:
                root.text += self.text
                root.text_object.text += self.text

        KeyboardButton:
            id: e_key
            text: 'e'
            size_hint: (0.1, 1)
            on_release:
                root.text += self.text
                root.text_object.text += self.text
        
        KeyboardButton:
            id: r_key
            text: 'r'
            size_hint: (0.1, 1)
            on_release:
                root.text += self.text
                root.text_object.text += self.text

        KeyboardButton:
            id: t_key
            text: 't'
            size_hint: (0.1, 1)
            on_release:
                root.text += self.text
                root.text_object.text += self.text

        KeyboardButton:
            id: y_key
            text: 'y'
            size_hint: (0.1, 1)
            on_release:
                root.text += self.text
                root.text_object.text += self.text
        
        KeyboardButton:
            id: u_key
            text: 'u'
            size_hint: (0.1, 1)
            on_release:
                root.text += self.text
                root.text_object.text += self.text

        KeyboardButton:
            id: i_key
            text: 'i'
            size_hint: (0.1, 1)
            on_release:
                root.text += self.text
                root.text_object.text += self.text

        KeyboardButton:
            id: o_key
            text: 'o'
            size_hint: (0.1, 1)
            on_release:
                root.text += self.text
                root.text_object.text += self.text

        KeyboardButton:
            id: p_key
            text: 'p'
            size_hint: (0.1, 1)
            on_release:
                root.text += self.text
                root.text_object.text += self.text
    
    MDBoxLayout:
        orientation: 'horizontal'
        spacing: 10
        size_hint: (1, 0.2)
        padding: (0.05*kivy.core.window.Window.width, 0)

        KeyboardButton:
            id: a_key
            text: 'a'
            size_hint: (0.1, 1)
            on_release:
                root.text += self.text
                root.text_object.text += self.text

        KeyboardButton:
            id: s_key
            text: 's'
            size_hint: (0.1, 1)
            on_release:
                root.text += self.text
                root.text_object.text += self.text

        KeyboardButton:
            id: d_key
            text: 'd'
            size_hint: (0.1, 1)
            on_release:
                root.text += self.text
                root.text_object.text += self.text

        KeyboardButton:
            id: f_key
            text: 'f'
            size_hint: (0.1, 1)
            on_release:
                root.text += self.text
                root.text_object.text += self.text

        KeyboardButton:
            id: g_key
            text: 'g'
            size_hint: (0.1, 1)
            on_release:
                root.text += self.text
                root.text_object.text += self.text

        KeyboardButton:
            id: h_key
            text: 'h'
            size_hint: (0.1, 1)
            on_release:
                root.text += self.text
                root.text_object.text += self.text

        KeyboardButton:
            id: j_key
            text: 'j'
            size_hint: (0.1, 1)
            on_release:
                root.text += self.text
                root.text_object.text += self.text

        KeyboardButton:
            id: k_key
            text: 'k'
            size_hint: (0.1, 1)
            on_release:
                root.text += self.text
                root.text_object.text += self.text

        KeyboardButton:
            id: l_key
            text: 'l'
            size_hint: (0.1, 1)
            on_release:
                root.text += self.text
                root.text_object.text += self.text

    MDBoxLayout:
        orientation: 'horizontal'
        spacing: 10
        size_hint: (1, 0.2)

        KeyboardButton:
            id: shift_key
            text: 'Aa'
            size_hint: (0.175, 1)
            on_release: app.shiftCase(root)

        KeyboardButton:
            id: z_key
            text: 'z'
            size_hint: (0.1, 1)
            on_release:
                root.text += self.text
                root.text_object.text += self.text

        KeyboardButton:
            id: x_key
            text: 'x'
            size_hint: (0.1, 1)
            on_release:
                root.text += self.text
                root.text_object.text += self.text

        KeyboardButton:
            id: c_key
            text: 'c'
            size_hint: (0.1, 1)
            on_release:
                root.text += self.text
                root.text_object.text += self.text

        KeyboardButton:
            id: v_key
            text: 'v'
            size_hint: (0.1, 1)
            on_release:
                root.text += self.text
                root.text_object.text += self.text

        KeyboardButton:
            id: b_key
            text: 'b'
            size_hint: (0.1, 1)
            on_release:
                root.text += self.text
                root.text_object.text += self.text

        KeyboardButton:
            id: n_key
            text: 'n'
            size_hint: (0.1, 1)
            on_release:
                root.text += self.text
                root.text_object.text += self.text
        
        KeyboardButton:
            id: m_key
            text: 'm'
            size_hint: (0.1, 1)
            on_release:
                root.text += self.text
                root.text_object.text += self.text

        KeyboardButton:
            id: back_key
            text: '<-'
            size_hint: (0.175, 1)
            on_release:
                root.text += self.text
                root.text_object.text += self.text

    MDBoxLayout:
        orientation: 'horizontal'
        spacing: 10
        size_hint: (1, 0.2)

        KeyboardButton:
            id: symbol_key
            text: '#+='
            size_hint: (0.2, 1)
            on_release:
                app.symbolKeys(root)

        KeyboardButton:
            id: space_key
            text: '[_________]'
            size_hint: (0.6, 1)
            on_release:
                root.text += ' '
                root.text_object.text += ' '

        KeyboardButton:
            id: done_key
            text: 'done'
            size_hint: (0.2, 1)
            on_release:
                app.keyboard_dialog(root)

<TextEntry>
    height: text_field.height

    MDTextField:
        id: text_field
        mode: 'round'
        hint_text: root.hint_text
        text: root.text
        icon_left: "key-variant"

    MDIconButton:
        id: text_keyboard_icon
        icon: "keyboard-outline"
        pos_hint: {"center_y": .5}
        pos: text_field.width - self.width, 0
        theme_text_color: "Hint"
        on_release: 
            app.keyboard_dialog(root)

<PasswordTextEntry>
    height: text_field.height

    MDTextField:
        id: text_field
        mode: 'round'
        hint_text: root.hint_text
        text: root.text
        password: True
        icon_left: "key-variant"

    MDIconButton:
        id: password_keyboard_icon
        icon: "eye-off"
        pos_hint: {"center_y": .5}
        pos: text_field.width - self.width*1.75, 0
        theme_text_color: "Hint"
        on_release:
            self.icon = "eye" if self.icon == "eye-off" else "eye-off"
            text_field.password = False if text_field.password is True else True

    MDIconButton:
        icon: "keyboard-outline"
        pos_hint: {"center_y": .5}
        pos: text_field.width - self.width, 0
        theme_text_color: "Hint"
        on_release:
            app.keyboard_dialog(root)

<KeyboardButton>
    text: root.text
    bold: True
    theme_text_color: 'Custom'
    text_color: app.theme_cls.accent_dark if app.theme_cls.theme_style == 'Light' else app.theme_cls.accent_light
    md_bg_color: app.theme_cls.primary_light if app.theme_cls.theme_style == 'Light' else app.theme_cls.primary_dark

<SettingsToggleButton>
    text: root.text
    ripple_scale: 0
    background_down: app.theme_cls.primary_light if app.theme_cls.theme_style == 'Light' else app.theme_cls.primary_dark
    font_color_down: app.theme_cls.accent_dark if app.theme_cls.theme_style == 'Light' else app.theme_cls.accent_light
    font_color_normal: app.theme_cls.primary_color